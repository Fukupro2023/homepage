---
import { Marked } from "marked";
import { markedHighlight } from "marked-highlight";
import hljs from "highlight.js";

type Props = {
  markdown: string;
  className?: string;
};

const props: Props = Astro.props;
const { markdown, className } = props;

// シンタックスハイライト付きの Marked インスタンス
const marked = new Marked(
  markedHighlight({
    langPrefix: "hljs language-",
    highlight(code, lang) {
      const pureLang = (lang || "").split(":")[0];

      if (pureLang && hljs.getLanguage(pureLang)) {
        return hljs.highlight(code, { language: pureLang }).value;
      }

      // 未対応言語は自動判定にフォールバック
      return hljs.highlightAuto(code).value;
    },
  }),
);

const parsedMarkdown = marked.parse(markdown);
---
<div
  class={`markdown-body ${className ?? ""}`}
  style="background-color: transparent !important;"
  set:html={parsedMarkdown}
/>
<script type="module" is:inline  src="/src/components/ui/MarkdownContainer/codeEnhancer.ts" />
